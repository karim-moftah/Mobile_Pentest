### Detection Based on Jailbreak Specific Files

When a device is jailbroken, many unix utilities (apt, su etc.), applications (Cydia.app) are written to the file system at specific locations. During runtime, an app can look if there are files existing at these paths to determine if the device is jailbroken or not. Below is a list of paths to files, applications which are written to the file system once a device is jailbroken.

```fallback
/Applications/Cydia.app
/private/var/stash
/private/var/lib/apt
/private/var/tmp/cydia.log
/private/var/lib/cydia
/private/var/mobile/Library/SBSettings/Themes
/Library/MobileSubstrate/MobileSubstrate.dylib
/Library/MobileSubstrate/DynamicLibraries/Veency.plist
/Library/MobileSubstrate/DynamicLibraries/LiveClock.plist
/System/Library/LaunchDaemons/com.ikey.bbot.plist
/System/Library/LaunchDaemons/com.saurik.Cydia.Startup.plist
/var/cache/apt
/var/lib/apt
/var/lib/cydia
/var/log/syslog
/var/tmp/cydia.log
/bin/bash
/bin/sh
/usr/sbin/sshd
/usr/libexec/ssh-keysign
/usr/sbin/sshd
/usr/bin/sshd
/usr/libexec/sftp-server
/etc/ssh/sshd_config
/etc/apt
```





#### Bypassing FileSystem Based Checks By Patching

Once we understand the jailbreak detection implementation, next step would be to bypass it. When we inspect the assembly code/CFG, we can see that irrespective of the checks performed, the decision is determined by a single instruction as seen below.

The **tbz** arm instruction tests a bit and branches if zero to the specified label.

In our case the instruction is `tbz w8, 0x0, loc_1000064ec`. This will check if the w8 register is zero and if zero the control will passed to the label `loc_1000064ec` from where the code which shows alert for showing device not jailbroken starts.

Now lets patch this instruction to branch to the label `loc_1000064ec` irrespective of the value of `w8` register. Goto modify menu in hopper and select assemble instruction.

Replace the instruction with just a branch instruction to the desired label.

```
b loc_1000064ec
```







#### Bypassing FileSystem Based Checks With Cydia Tweaks

There are several tweaks available in cydia which allows to bypass jailbreak detection. Below are some of the jailbreak detection bypass tweaks which works with different iOS versions.

| Tweak Name     | Cydia Repo                                        | iOS Version Support |
| -------------- | ------------------------------------------------- | ------------------- |
| xCon           | Available in Cydia Default Repo’s (ModMyi)        | iOS 9               |
| tsProtector 8+ | Available in Cydia Default Repo’s (BigBoss)       | iOS 8 & 9           |
| JailProtect    | [julioverne’s Repo](http://julioverne.github.io/) | iOS 10              |
| Shadow         | [Jolano’s Repo](https://ios.jjolano.me/)          | iOS 8.0 - 12.1.2    |
| Liberty Lite   | [Ryley’s Repo](http://ryleyangus.com/repo/)       | iOS 11 - 12         |
| UnSub          | [Nepeta Repo Mirror](http://nepeta.ignition.fun/) | iOS 9 - 12          |



### Detection Based on cydia:// URI Scheme

Most of the popular jailbreaks installs the Cydia store application and registers the **cydia://** uri scheme on the device. If an application is able to open a url starting with the **cydia://** uri scheme, the device must be jailbroken.

Let us modify the jailbreak detection to include more file system path checks along with the **cydia://** uri scheme check. The **jbCheck1** method performs file system based checks and **jbCheck2** does the cydia uri scheme check. in both the methods logging is enabled so that we can see the output of each check on the Xcode console during runtime.



https://flippingbitz.com/post/2019-10-24-jb-detec-bypass/

https://www.andnixsh.com/2020/10/how-to-bypass-jailbreak-detection.html

https://gist.github.com/izadgot/5783334b11563fb08fee4cd250455ede