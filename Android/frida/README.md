# Frida



## OWASP unCrackable level 1 Root detection bypass

in sg.vantagepoint.uncrackable1.MainActivity

```java
    protected void onCreate(Bundle bundle) {
        if (checkRoot.method1() || checkRoot.method2() || checkRoot.method3()) {
            a("Root detected!");
        }
        if (b.a(getApplicationContext())) {
            a("App is debuggable!");
        }
        super.onCreate(bundle);
        setContentView(R.layout.activity_main);
    }
```



in sg.vantagepoint.a.checkRoot

```java
public class checkRoot {
    /* renamed from: a */
    public static boolean method1() {
        for (String str : System.getenv("PATH").split(":")) {
            if (new File(str, "su").exists()) {
                return true;
            }
        }
        return false;
    }

    /* renamed from: b */
    public static boolean method2() {
        String str = Build.TAGS;
        return str != null && str.contains("test-keys");
    }

    /* renamed from: c */
    public static boolean method3() {
        for (String str : new String[]{"/system/app/Superuser.apk", "/system/xbin/daemonsu", "/system/etc/init.d/99SuperSUDaemon", "/system/bin/.ext/.su", "/system/etc/.has_su_daemon", "/system/etc/.installed_su_daemon", "/dev/com.koushikdutta.superuser.daemon/"}) {
            if (new File(str).exists()) {
                return true;
            }
        }
        return false;
    }
}
```

we want to hook on method 1, 2, 3 to make them return false.



application package: owasp.mstg.uncrackable1

function class: checkRoot

function name: method1, method2, method3

function argument: none

return type: boolean



in sg.vantagepoint.a.a

```java
public class a {
    public static byte[] a(byte[] bArr, byte[] bArr2) {
        SecretKeySpec secretKeySpec = new SecretKeySpec(bArr, "AES/ECB/PKCS7Padding");
        Cipher cipher = Cipher.getInstance("AES");
        cipher.init(2, secretKeySpec);
        return cipher.doFinal(bArr2);
    }
}
```





frida script to bypass root detection and get the secret key
hook.js

```java
Java.perform(function(){
    var my_cls = Java.use("sg.vantagepoint.a.checkRoot")
    my_cls.method1.implementation = function(){
		return false
    }
    my_cls.method2.implementation = function(){
    	return false
    }
    my_cls.method3.implementation = function(){
    	return false
    }
    
    
    var my_cls2 = Java.use("sg.vantagepoint.a.a")
    my_cls2.a.implementation = function(IV, Ct){
        var bArr = this.a(IV, Ct) 
        console.log("[+] bArr: " + bArr)
        let key = ""
        for(var i=0 ; i<bArr.length ; i++){
                key = key + String.fromCharCode(bArr[i])
        }

        console.log("[+] key: " + key)
        return bArr

    }

})
```



```
frida -U −l hook.js -f owasp.mstg.uncrackable1 --no-pause
```



also you can use **[frida code share](https://codeshare.frida.re/browse)**

```bash
└─$ frida -U --codeshare dzonerzy/fridantiroot  -f owasp.mstg.uncrackable1 
```

